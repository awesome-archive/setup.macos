#!/bin/sh
# vim: set ft=sh :

set -eu
cd $(dirname $0)

xcode-select --install || true
sudo xcodebuild -runFirstLaunch
if [ $(which brew | wc -l) -eq 0 ]; then
  echo 'Install the Homebrew.'
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
  source .zsh.d/homebrew
fi

echo 'Install from Homebrew Bundle.'
brew update
brew bundle --file 'Brewfile'
brew upgrade
brew cleanup

echo 'Install from GitHub.'
function git_clone_if_not_exists() {
  DST="${ZDOTDIR:-$HOME}/${2}"
  git -C "${DST}" pull || git clone --recursive "https://github.com/${1}.git" "${DST}"
}
git_clone_if_not_exists sorin-ionescu/prezto .zprezto
git_clone_if_not_exists anyenv/anyenv .anyenv
mkdir -p "${ZDOTDIR:-$HOME}/.anyenv/plugins"
mkdir -p "${ZDOTDIR:-$HOME}/.config/anyenv"
git_clone_if_not_exists znz/anyenv-update .anyenv/plugins/anyenv-update
git_clone_if_not_exists anyenv/anyenv-install .config/anyenv/anyenv-install

#!/bin/sh
# vim: set ft=sh :

set -eu
cd $(dirname $0)

./.setup.xcode.sh
./.setup.brew.sh
./.setup.git.sh

source .setup.lib.sh

echo 'Install the Prezto / zsh.d.'
function force_link() {
  rm -rf "${2}"
  ln -s "${1}" "${2}"
}
for rcfile in $(find "${ZDOTDIR:-$HOME}"/.zprezto/runcoms -type f -name 'z*'); do
  force_link "${rcfile}" "${ZDOTDIR:-$HOME}/.${rcfile##*/}"
done
for rcfile in $(find "$(pwd)" -name '.z*'); do
  force_link "${rcfile}" "${ZDOTDIR:-$HOME}/${rcfile##*/}"
done

echo 'Install the Anyenv & Nodenv.'
source .zsh.d/anyenv
anyenv install nodenv -s
source .zsh.d/anyenv

mkdir -p "${ZDOTDIR:-$HOME}/bin"
force_link "$(pwd)/bin/update" "${ZDOTDIR:-$HOME}/bin/update"
"${ZDOTDIR:-$HOME}/bin/update"

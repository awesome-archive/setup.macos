- name: Install the anyenv
  homebrew:
    name: anyenv
    state: present

- name: Create a folder for anyenv
  file:
    path: "{{ ansible_env.HOME }}/{{ item }}"
    state: directory
  with_items:
    - .config
    - .config/anyenv

- name: Initialize the anyenv
  git:
    repo: "https://github.com/anyenv/anyenv-install.git"
    dest: "{{ ansible_env.HOME }}/.config/anyenv/anyenv-install"
    force: true

- name: Detect a anyenv setting file
  stat:
    path: ~/.zsh.d/anyenv
  register: anyenv

- name: Deploy a anyenv setting
  template:
    src: anyenv
    dest: "{{ ansible_env.HOME }}/.zsh.d/anyenv"

- name: Create a folder for anyenv plugins
  file:
    path: $(anyenv root)/plugins
    state: directory
    mode: 0755

- name: set anyenv_root_path
  shell: echo $(anyenv root)/plugins/anyenv-update
  changed_when: false
  register: anyenv_root_path

- name: Initialize the anyenv-update
  git:
    repo: https://github.com/znz/anyenv-update.git
    dest: "{{ anyenv_root_path.stdout_lines }}"
    force: true

- name: Initialize the nodenv
  command: anyenv install nodenv -s
  register: nodenv
  changed_when: "nodenv.stdout != ''"
